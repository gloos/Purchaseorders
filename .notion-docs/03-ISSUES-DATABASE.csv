Title,Status,Priority,Type,Description,Solution/Notes
PO Number Race Condition,Open,High,Bug,"count()+1 approach for PO numbers can create duplicates under concurrent requests","Implement: Database sequence OR Counters table with FOR UPDATE lock OR use ULIDs for guaranteed uniqueness"
Missing Server-Side Input Validation,Open,Critical,Technical Debt,"API routes accept arbitrary JSON without validation. No Zod schemas for request bodies","Add Zod schemas for: CreatePurchaseOrder, UpdatePurchaseOrder, CreateOrganization, line items with quantity>0 and unitPrice>=0 constraints"
Hard-Coded Tax Rate (20%),Open,Medium,Bug,"VAT is hard-coded to 20% in PDF and email generation regardless of PO currency or supplier location","Add taxRate field to PO/line items. Create tax calculation utility. Support inclusive/exclusive/none modes. Use Intl.NumberFormat for currency display"
Hard-Coded Currency (GBP),Open,Medium,Bug,"Currency symbol £ is hard-coded despite POs having a currency field","Use PO.currency field + Intl.NumberFormat for proper currency rendering across PDFs and emails"
Test Email Address in Production,Open,High,Bug,"Uses onboarding@resend.dev which will hurt deliverability","Setup verified domain in Resend. Add replyTo field. Include plain-text email version. Consider PDF attachment"
Email Missing PDF Attachment,Open,Medium,Enhancement,"Email contains inline HTML but doesn't attach the PDF","Reuse PDF generation code from /pdf endpoint and attach buffer to email"
Email Missing Plain-Text Version,Open,Low,Enhancement,"HTML-only emails may be flagged by spam filters","Generate plain-text version alongside HTML using @react-email"
No Rate Limiting,Open,Medium,Technical Debt,"No rate limits on email sending or FreeAgent sync endpoints","Implement rate limiting middleware for public/sensitive endpoints"
Analytics Date Grouping Fragile,Open,Low,Bug,"Uses toLocaleDateString() for month grouping which is locale-dependent","Use YYYY-MM format for consistent month keys across timezones/locales"
No Prisma Indices Optimization,Open,Medium,Technical Debt,"Missing database indices for common query patterns","Add indices on: (organizationId, poNumber) unique, (organizationId, status), (organizationId, orderDate)"
Supabase Service Role Key Not Set,Open,Medium,Bug,"Service role key placeholder in .env prevents logo upload feature from working","User needs to add actual SUPABASE_SERVICE_ROLE_KEY from Supabase dashboard"
User Lookup Inconsistency,Fixed,Critical,Bug,"Some routes used email-based lookup while others used id-based causing issues when email changes","Created getUserAndOrgOrThrow() helper. Updated 6 routes to use id-based lookups consistently"
Line Item Update Not Atomic,Fixed,Critical,Bug,"PATCH route deleted line items and created new ones without transaction wrapping","Wrapped delete + create operations in prisma.$transaction() for atomicity"
Zero Total Bug,Fixed,High,Bug,"...(totalAmount && { totalAmount }) prevented saving $0.00 totals","Changed to ...(totalAmount !== undefined && { totalAmount }) to allow zero values"
Missing Server-Side Slug Validation,Fixed,Medium,Bug,"Organization slug only validated on client-side allowing invalid slugs to bypass checks","Added /^[a-z0-9-]{3,50}$/ regex validation on server-side in organizations POST route"
Prisma Client Not Regenerated,Fixed,Critical,Bug,"Schema changes weren't reflected in Prisma client causing field not found errors","Documented need to run npx prisma generate after schema changes"
Navbar Inconsistency,Fixed,Medium,Bug,"Navbar wasn't present or styled consistently across all pages","Created shared Navbar component used across all dashboard routes"
Email NaN Totals,Fixed,High,Bug,"Email showed £NaN for all totals due to incorrect Decimal to number conversion","Fixed parseFloat() calls on Prisma Decimal types in email template data prep"
FreeAgent Contact Pagination,Fixed,Medium,Bug,"Only first 25 contacts were displayed despite more being synced","Implemented pagination to fetch all pages from FreeAgent API"
FreeAgent Callback Blank Page,Fixed,Medium,Bug,"OAuth callback showed blank page instead of redirecting to dashboard","Added proper redirect after successful OAuth completion"